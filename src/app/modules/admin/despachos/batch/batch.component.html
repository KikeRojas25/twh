<div class="flex flex-col flex-auto min-w-0">

  <!-- Secci√≥n de Propietario -->
  <div #appendTo class="flex flex-col p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
    <p-toast></p-toast>
    <div class="flex flex-col mb-4">
      <label for="propietario" class="font-bold mb-2">Propietario:</label>
      <p-dropdown name="clientes" 
                  [options]="clientes" 
                  [(ngModel)]="model.PropietarioId" 
                  [filter]="true" 
                  filterBy="label" 
                  [showClear]="true" 
                  [style]="{'width': '100%'}" 
                  [resetFilterOnHide]="false"
                  [hideTransitionOptions]="'0ms'"
                  [showTransitionOptions]="'0ms'"
                  placeholder="Seleccione un propietario">
        <ng-template let-item pTemplate="selectedItem">
          <span>{{item.label}}</span>
        </ng-template>
      </p-dropdown>
    </div>

    <!-- Secci√≥n de Almac√©n -->
    <div class="flex flex-col">
      <label for="almacen" class="font-bold mb-2">Almac√©n:</label>
      <p-dropdown name="almacenes" 
                  [options]="almacenes" 
                  [(ngModel)]="model.AlmacenId" 
                  [filter]="true" 
                  filterBy="label" 
                  [showClear]="true" 
                  [style]="{'width': '100%'}" 
                  [resetFilterOnHide]="false"
                  [hideTransitionOptions]="'0ms'"
                  [showTransitionOptions]="'0ms'"
                  placeholder="Seleccione un almac√©n">
        <ng-template let-item pTemplate="selectedItem">
          <span>{{item.label}}</span>
        </ng-template>
      </p-dropdown>
    </div>
  </div>
  
  <!-- Secci√≥n de Upload de Archivos -->
  <div #appendTo class="p-6 border rounded-2xl shadow bg-white dark:bg-slate-800 mt-4">
    <p-fileUpload name="myfile[]" 
                  #fileUpload 
                  [multiple]="true" 
                  accept=".xlsx,.xls"  
                  maxFileSize="1000000"
                  customUpload="true"
                  (onUpload)="onTemplatedUpload($event)" 
                  (onSelect)="onSelectedFiles($event)">

      <!-- HEADER -->
      <ng-template pTemplate="header" let-files let-chooseCallback="chooseCallback">
        <div class="flex items-center justify-between w-full">
          <div class="flex gap-2">
            <!-- üìÇ Seleccionar -->
            <p-button (onClick)="choose($event, chooseCallback)" 
                      icon="pi pi-folder-open" 
                      [rounded]="true" 
                      [outlined]="true" 
                      pTooltip="Seleccionar archivo">
            </p-button>

            <!-- ‚¨Ü Subir -->
            <p-button (onClick)="uploadSelectedFiles()" 
                      icon="pi pi-cloud-upload" 
                      [rounded]="true" 
                      [outlined]="true" 
                      severity="success" 
                      [disabled]="!files || files.length === 0"
                      pTooltip="Subir archivos">
            </p-button>

            <!-- ‚úÖ Procesar -->
            <p-button (onClick)="procesar()" 
                      icon="pi pi-check-circle" 
                      [rounded]="true" 
                      [outlined]="true" 
                      severity="success" 
                      [disabled]="!model.CargaId"
                      pTooltip="Confirmar y procesar">
            </p-button>
          </div>
        </div>
      </ng-template>

      <!-- CONTENT -->
      <ng-template pTemplate="content" let-files let-uploadedFiles="uploadedFiles" let-removeFileCallback="removeFileCallback" let-removeUploadedFileCallback="removeUploadedFileCallback">
        
        <!-- Pendientes -->
        <div *ngIf="files?.length > 0">
          <h5 class="font-bold mb-2 text-yellow-600">Pendientes</h5>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div *ngFor="let file of files; let i = index" 
                 class="p-4 border rounded-xl shadow-sm flex flex-col items-center bg-yellow-50">
              <i class="pi pi-file-excel text-green-600 text-5xl"></i>
              <span class="mt-2 font-semibold text-sm text-center">{{ file.name }}</span>
              <span class="text-xs text-gray-500">{{ formatSize(file.size) }}</span>
              <p-badge value="Pending" severity="warning" class="mt-2"></p-badge>
              <p-button icon="pi pi-times" 
                        (onClick)="onRemoveTemplatingFile($event, file, removeFileCallback, i)" 
                        [rounded]="true" 
                        severity="danger" 
                        class="mt-2"
                        pTooltip="Eliminar">
              </p-button>
            </div>
          </div>
        </div>

        <!-- Completados -->
        <div *ngIf="uploadedFiles?.length > 0" class="mt-6">
          <h5 class="font-bold mb-2 text-green-600">Completados</h5>
          <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <div *ngFor="let file of uploadedFiles; let i = index" 
                 class="p-4 border rounded-xl shadow-sm flex flex-col items-center bg-green-50">
              <i class="pi pi-file-excel text-green-600 text-5xl"></i>
              <span class="mt-2 font-semibold text-sm text-center">{{ file.name }}</span>
              <span class="text-xs text-gray-500">{{ formatSize(file.size) }}</span>
              <p-badge value="Completed" severity="success" class="mt-2"></p-badge>
              <p-button icon="pi pi-times" 
                        (onClick)="removeUploadedFileCallback(i)" 
                        [rounded]="true" 
                        severity="danger" 
                        class="mt-2"
                        pTooltip="Eliminar">
              </p-button>
            </div>
          </div>
        </div>
      </ng-template>

      <!-- EMPTY -->
      <ng-template pTemplate="empty">
        <div class="flex flex-col items-center justify-center p-10 border-2 border-dashed rounded-xl text-gray-400 hover:border-blue-400 hover:text-blue-400 transition">
          <i class="pi pi-cloud-upload text-6xl mb-3"></i>
          <p class="text-center">Arrastra tus archivos aqu√≠ o haz clic en el bot√≥n para seleccionar.</p>
        </div>
      </ng-template>
    </p-fileUpload>
  </div>
  
  <!-- Secci√≥n de Errores -->
  <div #appendTo class="flex flex-col p-6 sm:py-8 sm:px-10 border-b bg-card dark:bg-transparent">
    <div class="grow w-64">
      <h2 class="font-bold">Errores</h2>
      <p>{{ errors }}</p>
    </div>
  </div>

</div>
