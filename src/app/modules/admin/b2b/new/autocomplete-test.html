<!-- REEMPLAZO COMPLETO DEL AUTOCOMPLETE EN new.component.html -->
<!-- Desde la línea 260 hasta la línea 296 -->

<!-- Producto -->
<label class="block text-xs font-medium text-gray-700 mb-1">Producto</label>
<p-autoComplete
  [(ngModel)]="model.productoSeleccionado"
  [suggestions]="productosFiltrados"
  [ngModelOptions]="{ standalone: true }"
  (completeMethod)="buscarProductos($event)"
  (onSelect)="onProductoSeleccionado($event)"
  field="nombreCompleto"
  [minLength]="3"
  [delay]="500"
  [forceSelection]="false"
  placeholder="Escriba al menos 3 caracteres..."
  [style]="{ width: '100%' }"
  styleClass="w-full"
  inputStyleClass="w-full"
  [dropdown]="false"
  emptyMessage="No se encontraron productos"
>
  <ng-template let-producto pTemplate="item">
    <div class="flex flex-col py-2">
      <span class="font-medium">{{ producto.codigo }} - {{ producto.nombreCompleto }}</span>
      <small class="text-gray-500">Unidad: {{ producto.unidad }}</small>
    </div>
  </ng-template>
</p-autoComplete>

<!-- Debug info -->
<div class="mt-1 text-xs text-gray-500">
  <div *ngIf="!idPropietario" class="text-amber-600">
    <i class="pi pi-exclamation-triangle"></i> Seleccione un propietario primero
  </div>
  <div *ngIf="idPropietario">
    Propietario seleccionado: {{ idPropietario }}
  </div>
</div>

<!-- Enlace para ver stock -->
<div class="mt-2 flex justify-between items-center">
  <a
    class="cursor-pointer text-xs text-blue-600 hover:underline"
    (click)="verStock()"
    *ngIf="model.productoSeleccionado"
  >
    <i class="pi pi-chart-bar mr-1"></i>
    Ver stock disponible
  </a>

  <button
    *ngIf="model.productoSeleccionado"
    pButton
    type="button"
    icon="pi pi-times"
    class="p-button-text p-button-sm p-button-danger"
    (click)="limpiarProducto()"
    pTooltip="Limpiar selección"
  ></button>
</div>
